---
---
Redovisning kmom10
=========================

### Krav 1
Till första kravet ska vi skapa den generella webbplatsen. Jag väljer att göra en webbplats om spel, så spel är alltså min produkt. Det första jag ska göra är att skapa en framsida, jag väljer att vänta med den då jag kommer fokusera på den i krav 4. Så då istället börjar jag med en produktsida. Jag börjar med att skapa en tabell i SQL, och den tabellen innehåller id, titel, beskrivning, pris, utgivningsår, utvecklare, betyg och bild. Jag lägger in 5 spel i tabellen för att göra et enklare att bygga hemsidan. Efter det skapar jag en ProductsController, och det är där all kod kommer att hamna. Jag börjar med att skapa en indexAction, vilket blir framsidan för produkterna, jag lägger till en navbar, som tar oss tillbaka till index om vi klickar på den. Jag ansluter mig till databasen och hämtar all information ifrån tabellen games. Jag lägger till en sida som är min vy och sedan renderar sidan. I vyn har jag bara en enkel tabell som visar 5 utav 7 tabell kolumner. Jag gör titeln till klickar som sedan kommer göra en översikt av produkten, och till den skapar jag en ny router i kontrollen. Den heter viewProductsAction och tar produkt id:et som argument, den gör nästan samma som indexAction, skillnaden är att SQL:en är annan, vi hämtar endast spel där id:et är ?, dvs. den produkten vi har klickat på i index. I vyn skapar jag en osorterad lista som innehåller alla kolumner ifrån tabellen.

Sedan ska jag skapa en nyhetsblogg, precis som ovan börjar jag med att skapa en ny tabell, den tabellen innehåller id, path, slug, titel, data, typ, publicerat, uppdaterat och bild. Och jag lägger in 5 inlägg. Sedan skapar jag en BloggController, även där har jag först en indexAction, den fungerar precis som ovan men i SQL:en här så hämtar vi allt ifrån blogg där typen är utav post, och vi sorterar efter publicerings datumet. Sedan i vyn skapar jag en artikel med en foreach loop som går igenom varje inlägg och skriver ut titeln, publicerings datumet och en del utav datan (beskrivningen). Titeln är klickbar. Så vi skapar en ny router till den som vi kallar för viewBloggAction, den fungerar precis som viewProductsAction. Och i vyn till den så gör vi samma artikel men vi lägger in bild och hela beskrivningen.

Sedan ska jag skapa en 'om' sida, och den är skapad i markdown så det är bara ren text i den. Jag beskriver företaget jag skapar och lite information om mig själv. Jag skapar även en header, en logo och titel. Min header är inget särskilt, den skiftar mellan två färger och visar min navbar och logo. Min logo är en sköldpadda utav anledningen av att företagsnamnet är 'Turtle Gaming' så det kändes passande! Jag har även en 'Flash bild' som är ett lysande tangentbord, och för att få den att inkluderas på varje sida, inte bara mina markdown filer så lade jag till den i config/page.php. Jag har en footer som har lite generell information om företaget och copyright, även den är gjord i markdown.

### Krav 2
Till krav två ska vi dokumentera lite om webbplatsen. Jag börjar med att skapa en markdown fil där jag börjar med att beskriva min kodstruktur. Jag berättar att jag använder kontroller till alla klasser förutom en, att dom innehåller en catch funktion, hur man sedan skapar en router för en kontrollklass och hur jag gör mina vyer.

Sedan har jag skapat ett ER-diagram. Jag har skapat den igenom MySQL Workbench och sedan har jag kopplat tabellerna till dom som dom använder sig utav. Min user tabell är helt självständig, sedan har jag frontpage som kan innehåller flera 'games' och även flera 'blogg'. Jag har inte använt mig utav foreign keys utan kopplat dom på andra sätt som jag kommer beskriva i senare krav. Annars är tabellerna väldigt enkla.

Jag har även sett till att det fungerar att göra make phpunit, make test och make doc.

Jag testade endast textfilter klassen som har markdown och gravatar funktionen, resten vet jag tyvärr inte hur man testar, därför blev min kodtäckning edast 1.82%. Men bättre än ingenting.

### Krav 3
Till krav tre ska vi fixa ett administrativt gränssnitt. Jag börjar med att skapa en ny tabell som heter user och den innehåller id, användarnamn, epost, namn, lösenord och roll. Roll har gjort gjort till en ENUM('admin', 'user') vilket betyder att det är bara om som existerar i den kolumnen, och på så sätt kan man enkelt välja om en användare ska vara admin eller bara en användare. Pga. hur jag har skapat lösenord till krav 5 så kan man inte göra en enkel insert då lösenordet använder sig utav en hash, men det kommer jag beskriva i senare. Jag börjar med att skapa en kontroller AdminController där jag kommer lägga allt som endast en admin kan göra. Jag börjar med att skapa en ny funktion CheckAdmin, den kommer jag använda för alla kommande routrar för att se till att användaren är en admin. Jag börjar med att hämta session datan och kolla om dom är inloggade så är deras roll admin, är dom inte det så redirectar vi dom tillbaka till första sidan. Sedan skapar jag en indexAction som våran förstasida, den hämtar alla data ifrån user och lägger till en vyn, i vyn hämtar vi all info ifrån tabellen och skriver ut den, alltså vi ser alla användare som är registrerade och om dom är admin eller inte.

Sedan ska vi se till att admin kan göra CRUD på produkterna. Jag skapar en ny route manageProducts, där lägger jag till en admin navbar så vi enkelt kan hitta runt i gränssnittet. Vi hämtar alla data ifrån 'games' och lägger till en vy, i vyn visar jag en tabell översikt på produkterna, precis som i den vanliga produkt sidan. Men vi skapar även två action knappar, redigera och radera i våran tabell. Längst upp på sidan har vi en länk till att skapa en ny produkt. För att skapa en ny produkt så gör jag först två nya funktioner en addProductActionGet och en Post. I get funktionen kallar vi på checkAdmin och lägger till en vy. I post ansluter vi oss till databasen, vi hämtar alla info i tabellen och sparar dom i variabler så att vi sedan kan använda dom i våran vy. Vi kollar också att användaren skriver in ett giltigt pris, år och betyg för vi vill inte att dom ska vara tomma. Är dom inte tomma så lägger vi in allt som användaren har skrivit in i våran SQL med hjälp utav insert. Egentligen behöver vi inte spara variablerna i en add funktion då vi inte vill fylla i dom automatiskt, men tanken var att jag ville spara det användaren hade skrivit in men hade skrivit in något ogiltigt och sidan laddades om, men det blev aldrig så. I vyn har jag en enkel form med inputs och vi sparar det användaren skriver in.

Jag har även två funktioner checkSlug och checkPath, och det dom gör är att kolla så att det bara finns en utav det användaren har skrivit in då dom båda har unika värden i databasen.

Sedan gör jag min radera funktion. Jag skapar även här två funktioner deleteproductActionGet och Post, här tar vi även emot produkt id:et som argument. Get funktionen ansluter sig till databasen och hämtar all data ifrån 'games' där id:et är ? (alltså den produkten användaren har klickat på). Vi skapar två vyer, en översikt och en för att ta bort produkten. Översikten hämtar vi ifrån produkt vyn ifrån krav 1. Och sedan i post raderar vi 'games' där id:et är ?, och redirectar användaren tillbaka till admin översikten av produkterna. I vyn för att ta bort produkten har vi ett post formulär med ett gömt fält som är id:et för produkten vi tryckt på, och sedan en knapp för att radera. Eftersom att vi la in produkt vyn också så kommer vi se den tillsammans med knappen för att användaren ska veta att dom klickat på rätt produkt.

Till sist gör jag min redigera funktion. Jag skapar två funktioner editProductActionGet och Post, som tar emot produkt id:et som argument. Get funktionen här fungerar precis som delete med en annan vy. I post funktionen gör jag som i add funktionen, hämtar infon ifrån tabellen och sparar dom i variabler. Vi uppdaterar tabellen genom att göra en update i sql:en. Till vyn lägger jag in alla variabler så att vi kan 'befolka' formuläret. Och det enda vi behöver göra i formuläret är att lägga till ett value för varje input och value blir våran variabel.

Sedan ska vi göra en CRUD på bloggen. Det fungerar precis likadant som jag beskrivit ovan, enda skillnaden blir namnen då vi använder oss utav en annan tabell.

Till sist vill vi kunna använda markown textfilter på texterna i både blogg och produkt. Så jag använder mig utav MyTextFiter klass ifrån kmom06 där vi börjar med att skapa en array av filters. Sedan skapar vi en funktion parse som tar in argumenten text och filter. Jag har kvar alla andra filter, men jag kommer inte gå igenom dom här. Vi gör ett switch case och i case "markdown" så kallar vi på funktionen markdown. Den funktionen returnerar 'Markdown::defaultTransform($text)' vilket är en funktion som vi har importerat ifrån '\Michelf\Markdown' och den ska konvertera text till markdown.

För att använda markdown i både blogg och produkt så har jag en funktion runMarkdown, den skapar ett nytt textfilter genom att kalla på våran klass MyTextFilter. Och sedan kallar vi på parse med $text och "markdown" som textfilter. Sedan i viewBloggAction och viewProductAction så kallar vi på runMarkdown på våran data/beskrivning. I BloggController kallar vi även på funktionen i indexAction, då är vi tvungna att göra en foreach så att vi gör en markdown på alla inlägg.


### Krav 4
Till krav 4 ska vi fixa förstasidan på webbplatsen. Så jag börjar med att skapa en ny tabell 'frontpage' och den innehåller id, featured blogg id, rekommenderad produkt id, senaste produkt id, erbjudande produkt och blogg id. Jag skapar en ny kontroll FrontpageController, och den innehåller indexAction. I index har vi ganska många sql statements. Den första hämtar ut all data ifrån blogg där typ är post och sorterar den på publiseringsdatumet, och vi begränsar till 3. Och på så sätt kan vi få ut dom 3 senaste blogg inläggen. I nästa sql så gör vi en select på titeln, data, bild och blogg id:et ifrån frontpage och blogg och vi sätter 'featured_blogg_id' till blogg id:et, och på så sätt kan vi skapa ett featured blogg inlägg. Nästa sql gör vi en selectt på titel, pris, bild och spel id:et ifrån frontapge och games där latest_product_id är spel id:et, och på så sätt kan vi skapa senaste produkten. (Vi skulle kunna göra efter publiseringsdatumet men jag valde att göra så här istället.) I nästa sql gör vi samma sak, fast vi ändrar latest till offered och då kan vi skapa produkt erbjudanden. I nästa sql gör vi samma som featured_blogg_id fast vi ändrar till offered_blogg_id och då kan vi skapa blogg erbjudanden. I min sista sql så gör jag en select på titel, pris, bild, betyg och spel id:et ifrån frontpage och games där rec_product_id är spel id:et och då kan vi skapa rekommenderade produkter. När vi exekverar varje sql så har jag sparat dom till en enskild variabel som vi sedan kan använda i våran vy som vi skapar.

I min vy skapar jag först en fpWrapper div som allting komma ligga i, sedan har varje kolumn sin egna div. Jag har först en artikel för alla featured blogg inlägg där man kan klicka på "Läs mer" för att se hela inlägget. Sedan har jag en artikel för dom tre senaste blogg inläggen där man också kan trycka på "Läs mer" för att se hela inlägget. Sedan har jag en osorterad lista där jag visar dom senaste spelen, jag visar titeln och priset på spelet. Sedan har jag ännu en osorterad lista där jag visar upp veckans erbjudande. Jag har både blogg och produkt erbjudanden där, och trycker man på titeln kommer man till hela inläggen. Till sist har jag en osorterad lista för produkt rekommendationerna och där skriver jag ut titeln, priset och även betyget.

I min CSS har jag skapat en grid för fdWrapper och sedan har jag placerat ut divarna med grid-column och grid-row. På så sätt har jag featured längst upp till vänster, under kommer dom tre senaste blogg inläggen och på höger sida har jag först senaste spel, veckans erbjudande och rekommendationer.

För att sedan kunna ändra inläggen har jag skapat ett nytt gränssnitt i admin vyn där man kan hantera förstasidan, och då har jag även lagt till flera funktioner i min AdminController. Jag börjar med att skapa en ny funktion manageFrontpageAction och den hämtar all info infrån 'frontpage' tabellen, och sedan lagt till en vy. Vyn innehåller en tabell med alla kolummner från databas tabellen, den kan vara lite svår att läsa då den endast innehåller siffror vilket är id:et på olika produkter/bloggar.

Sedan för att lägga till mer på framsidan så har jag en addFrontpageActionGet och Post. I get hämtar vi all data ifrån både blogg och games, och lägger till dom i en vy. Sedan i post hämtar vi all info ifrån databasen, vi sparar dom till variabler så att vi kan använda dom i våran vy. Vi gör sedan en insert into frontpage med allt som användaren skrivit in i vårat formulär, i det här formuläret har jag använt mig utav en dropdown meny, så man kan endast välja det som finns i listan. Jag har satt den första menyn till att vara tom så att man inte ska behöva lägga in något i varje meny.

Sedan har jag en deleteFrontpageActionGet och Post som tar in id som argument. I våran get funktion har vi ganska många sql statements. Förutom den första där vi hämtar alla data ifrån frontpage där id:et är ? så är resten bara för att kunna visa upp vad det är vi raderar, därför hämtar vi endast titeln ifrån blogg/games ifrån dom olika kolumnerna. I våran post sparar vi vårat id till en variabel och sedan tar vi bort allt ifrån förstasidan där id:et är ?. I våran vy kollar vi om dom olika kolumnerna är större än 0, är dom det skriver vi ut dess titel, och sedan har vi en ta bort knapp.

### Krav 5
Till krav 5 ska vi registrera ett nytt konto. För att göra det använder jag mig utav min nuvranade tabell 'user'. Jag börjar med att skapa en ny kontroller UserController, och jag börjar med att skapa två nya funktioner registerActionGet och Post. I våran get funktionen ansluter vi oss endast till databsen och lägger till en vy. I våran post funktion börjar jag med att sätta en del variabler till tomma strängar. Sedan börjar vi med att kolla användarnamnet som användaren skriver in, vi kollar om den är tom, är den det kommer ett felmeddelande upp, är den ifylld så gör vi en select på id:et ifrån user där username är ?, vi gör en trim på användarnamnet om dom har lämnat mellanslag i namnet. Efter att vi exekverar sql:en så kollar vi om det redan finns en användare med det namnet, gör det de som kommer ännu ett felmeddelande upp. Sedan gör vi samma sak med lösenordet, fast här ska man skriva in lösenordet två gånger så vi kollar att när dom skriver in det den andra gånger att den matchar med den första. Sedan kollar vi om det finns några felmeddelanden, gör det inte det så gör vi en insert, vi sätter rollen till 'user', så vill man skapa en admin användare så kan man ändra den biten till 'admin'. Och sedan skapar vi ett hash till lösenordet, med hjälp utav den inbyggda funktionen password_hash, vi gör detta för att det ska vara säkert, för det är aldrig meningen att den som äger databasen ska kunna se andras lösenord. Till sist lägger vi till en vy, och det är ett vanligt formulär som tidigare. vi lägger även till våra felmeddelanden där om dom skulle behövas.

Nu när man kan registrera en användare så skapar vi ett login formulär. Vi börjar med att skapa två nya funktioner loginActionGet och post. I get gör vi som vi gjort tidigare med admin och kollar om användaren är inloggad med hjälp utav sessionen. Sedan gör vi likt som i register, vi kollar så att användarnamnet och lösenordet inte är tomt. Är fälten ifyllda så gör vi en select ifrån user och exekverar den. Sedan kollar vi om användaren existerar, gör den inte det kommer ett felmeddelande upp, annars gör vi en password_verify och kollar om lösenordet är rätt för den användaren. Är det inte det så kommer ett felmeddelande upp annars så sätter vi en del sessions variabler, "userLoggedIn" är sant, på så sätt vet vi att användaren är inloggad, vi sätter även id:et, namnet och rollen. Vi redirectar till framsidan och vi lägger till en vy. Vyn är precis som den ovan med andra värden, bara ett enkelt formulär.

Nu när man kan logga in vill vi skapa en profilsida för användaren. Så jag skapar en ny funktion profileAction, där börjar vi med att kolla att användaren är inloggad med våran session variabel "userLoggedIn". Är användaren inloggad hämtar vi all data ifrån user tabellen, och här hämtar vi även en gravatar för användaren genom att kalla på funktionen getGravatar som tar användaren epost som argument, har inte användaren skrivit in en epost så kommer en default bild visas. Den här funktionen har jag hämtat ifrån [Gravatar.org](https://sv.gravatar.com/site/implement/images/php/). Funktionen kollar om användarens epost finns, och gör den det så vissas användarens egna bild upp. Vi lägger sedan till en vy, i vyn visar jag gravatar bilden, användarnamnet, personens namn, epost och roll. Man kan redigera både namnet och eposten genom att klicka på ikonen.

För att redigera sitt namn så skapar vi en ny funktion editNameActionGet och Post. I get funktionen börjar vi med att kolla att användaren är inloggad och vi hämtar infon om användaren genom id:et som är inloggat och sedan skapar vi en vy. I Post kollar vi också att användaren är inloggad och sedan sparar vi dess id och namn i variabler. Vi gör en sql update där vi sätter namnet till ?. I våran vy har vi ett enkelt formulär där användaren får skriva in sitt namn och sedan trycka på spara.

För att redigera sin epost gör vi samma sak som med namn fast istället för namn i sql tabellen så gör vi epost.

Sedan har jag även skapat en logga ut funktion, och det enda vi gör är att ändra sessionen. Vi sätter "userLoggedIn" till falskt, id:et till 0, username och roll till tomma strängar. I config/navbar har jag ändrat i header, plain och responsive, vi kollar i sessionen om "userLoggedIn" inte är sant, är det de så har vi en logga in navbar. Är det sant så lägger vi till en profil navbar och en logga ut.

### Om Projektet
Jag tycker att det här var ett bra projekt för kursen. Tycker att vi borde ha haft en vecka till på oss då jag inte hann med det sista kravet. Jag tycker att det har varit roligt att få hålla på med ramverket hela projektet. Tycker däremot att det vi har gjort har nästan varit som databas kursen, då vi nästan endast har hållit på med sql i projektet och mycket utav samma slags funktioner hela tiden. Jag skulle också vilja göra med enhetstester, men vi har inte lärt oss göra det med databasen. Men för övrigt en hyfsat roligt projekt, man fick komma på en egen idé av produkt och göra vad man ville utav det.

## Om Kursen
Jag tycker att det har varit en bra och lärofull kurs. Det har varit intressant att få lära sig om hur man programmerar i ett ramverk. Jag tycker att materialet och allt har varit bra, det har hjälp med videoserier till vissa uppgifter. Dock har det varit lite konstigt med föreläsningarna, ibland har dom inte dykt upp på tisdagar utan någon förvarning, så man har gått och väntat på ingenting. Så skulle gärna vilja få något slags meddelande i framtiden om det inte blir något. Som jag skrev ovan skulle jag velat ha lära mig mer enhetstestning. Men förutom det så är det är bra kurs och jag skulle rekommendera den till dom som är intresserade utav databaser/php/oophp. Kursen får 7/10 av mig.
